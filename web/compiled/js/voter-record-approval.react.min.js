var VoterHistoryDatatable=React.createClass({displayName:"VoterHistoryDatatable",getInitialState:function(){return{typingTimer:null,doneTypingInterval:1500}},componentDidMount:function(){this.gridTable()},gridTable:function(){var e=this,t=new Datatable,a=$("#voter_history_table");t.init({src:a,dataTable:{bState:!0,autoWidth:!0,serverSide:!0,processing:!0,deferRender:!0,dom:'<"top">rt<"bottom"lp><"clear">',ajax:{url:Routing.generate("ajax_datatable_voter_history",{voterId:e.props.voterId}),type:"GET"},columnDefs:[{className:"text-center valign-middle",orderable:!1,targets:[0,1,2,3,4,5,6]}],order:[[7,"desc"]],columns:[{data:null,className:"text-center",width:30,render:function(e,t,a,l){return l.settings._iDisplayStart+l.row+1}},{data:"precinct_no",className:"text-center",width:"80px"},{data:"municipality_name",width:"150px"},{data:"barangay_name",className:"text-center",width:"100px"},{data:null,className:"text-center",width:"30px",render:function(e,t,a){var l="";return l+=1==a.has_ast?"*":"",l+=1==a.has_a?"A":"",l+=1==a.has_b?"B":"",l+=1==a.has_c?"C":""}},{data:null,className:"text-center",width:"10px",render:function(e,t,a){var l="";return l+=1==a.is_1?"1,":"",l+=1==a.is_2?"2,":"",l+=1==a.is_3?"3,":"",l+=1==a.is_4?"4,":"",l+=1==a.is_5?"5,":"",l+=1==a.is_6?"6,":"",l+=1==a.is_7?"7,":"",l=l.slice(0,l.lastIndexOf(","))}},{data:"created_by",width:"140px",className:"text-center"},{data:"created_at",width:"140px",className:"text-center",render:function(e){return moment(e).format("MM/DD/YYYY hh:mm A")}}]}}),a.on("click",".edit-btn",function(){var a=t.getDataTable().row($(this).parents("tr")).data();e.edit(a.voter_id)}),a.on("click",".view-btn",function(){var a=t.getDataTable().row($(this).parents("tr")).data();e.view(a.voter_id)}),e.grid=t},reload:function(){this.grid.getDataTable().ajax.reload()},render:function(){return React.createElement("div",{className:"col-md-12"},React.createElement("div",{className:"table-container"},React.createElement("div",{className:"table-actions-wrapper"},React.createElement("span",null," ")),React.createElement("table",{id:"voter_history_table",className:"table table-striped table-bordered",width:"100%"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"No"),React.createElement("th",null,"Precinct No"),React.createElement("th",null,"Municipality"),React.createElement("th",null,"Brgy"),React.createElement("th",null,"Stat"),React.createElement("th",null,"Tag"),React.createElement("th",null,"Updated by"),React.createElement("th",null,"Updated At"))),React.createElement("tbody",null))))}});window.VoterHistoryDatatable=VoterHistoryDatatable;var Modal=ReactBootstrap.Modal,VoterViewModal=React.createClass({displayName:"VoterViewModal",getInitialState:function(){return{voterName:""}},render:function(){return React.createElement(Modal,{keyboard:!1,enforceFocus:!1,bsSize:"lg",backdrop:"static",show:this.props.show,onHide:this.props.onHide},React.createElement(Modal.Header,{className:"modal-header bg-blue-dark font-white",closeButton:!0},React.createElement(Modal.Title,null,"Details")),React.createElement(Modal.Body,{bsClass:"modal-body overflow-auto"},React.createElement("div",{className:"row voter-view-header"},React.createElement("div",{className:"col-md-12",style:{marginBottom:"15px"}},React.createElement("div",null,React.createElement("em",null,React.createElement("small",null,"Last Updated : ",moment(this.state.updatedAt).format("MMM DD, YYYY hh:mm: A")))),React.createElement("div",null,React.createElement("em",null,React.createElement("small",null,"Updated By : ",this.state.updatedBy)))),React.createElement("div",{className:"col-md-6"},React.createElement("div",null,React.createElement("strong",null,"Name : ")," ",this.state.voterName," "),React.createElement("div",null,React.createElement("strong",null,"Municipality :")," ",this.state.municipalityName," "),React.createElement("div",null,React.createElement("strong",null,"Barangay :")," ",this.state.barangayName," "),React.createElement("div",null,React.createElement("strong",null,"Voter No :")," ",this.state.voterNo," "),React.createElement("div",null,React.createElement("strong",null,"Precinct No :")," ",this.state.precinctNo," ")),React.createElement("div",{className:"col-md-6"},React.createElement("div",null,React.createElement("strong",null,"Cellphone No :")," ",this.state.cellphone," "),React.createElement("div",null,React.createElement("strong",null,"Address :")," ",this.state.address," "),React.createElement("div",null,React.createElement("strong",null,"2017 : ")," ",0==this.state.voted2017?"NO":"YES"," "),React.createElement("div",null,React.createElement("strong",null,"Stat : ")," ",this.state.voterStatus," "),React.createElement("div",null,React.createElement("strong",null,"Tag : ")," ",this.state.voterClass," "))),React.createElement("div",{className:"row"},React.createElement(VoterHistoryDatatable,{voterId:this.props.voterId}))))},componentDidMount:function(){this.loadVoter(this.props.voterId)},loadVoter:function(e){var t=this;t.requestVoter=$.ajax({url:Routing.generate("ajax_get_voter",{voterId:e}),type:"GET"}).done(function(e){t.setState(e)})}});window.VoterViewModal=VoterViewModal;var Modal=ReactBootstrap.Modal,FormGroup=ReactBootstrap.FormGroup,HelpBlock=ReactBootstrap.HelpBlock,ControlLabel=ReactBootstrap.ControlLabel,FormControl=ReactBootstrap.FormControl,VoterApprovalModal=React.createClass({displayName:"VoterApprovalModal",getInitialState:function(){return{form:{data:{voters:[]},errors:[]},votersList:[],unselected:[],maxChars:160}},getDefaultProps:function(){return{create:!0}},componentDidMount:function(){this.initSelect2(),this.initMultiSelect()},initSelect2:function(){var e=this;$("#form-municipality-select2").select2({casesentitive:!1,placeholder:"Enter Name...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_municipality"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.municipality_no,text:e.name}})}}}}),$("#form-barangay-select2").select2({casesentitive:!1,placeholder:"Enter name...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_barangay"),data:function(e){return{searchText:e.term,municipalityNo:$("#form-municipality-select2").val()}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.brgy_no,text:e.name}})}}}}),$("#form-municipality-select2").on("change",function(){e.setFormPropValue("municipalityNo",$(this).val())}),$("#form-barangay-select2").on("change",function(){e.setFormPropValue("brgyNo",$(this).val()),e.loadVoters()})},setFormPropValue:function(e,t){var a=this.state.form;a.data[e]=t,this.setState({form:a})},setFormProp:function(e){var t=this.state.form;t.data[e.target.name]=e.target.value,this.setState({form:t})},setErrors:function(e){console.log("setting errors");var t=this.state.form;t.errors=e,this.setState({form:t})},getError:function(e){var t=this.state.form.errors;for(var a in t)if(a==e)return t[e];return null},getValidationState:function(e){return null!=this.getError(e)?"error":""},numberWithCommas:function(e){e=parseFloat(e).toFixed(2);var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},isEmpty:function(e){return null==e||""==e},reset:function(){var e=this.state.form;e.data.brgyNo="",e.errors=[],$("#form-barangay-select2").empty().trigger("change"),$("#voter-form #excel-file").val(""),this.setState({details:null,form:e})},setFile:function(e){this.setState({file:$(this)[0].files[0]})},submit:function(e){e.preventDefault();var t=this,a=t.state.form.data;t.requestPostApproval=$.ajax({url:Routing.generate("ajax_post_voter_approval"),type:"POST",data:a}).done(function(e){t.props.onHide()}).fail(function(e){"401"==e.status?t.props.notify("You dont have the permission to update this record.","ruby"):t.props.notify("Form Validation Failed.","ruby"),t.setErrors(e.responseJSON)})},initMultiSelect:function(){var e=this,t=this.refs.selectBox;$(t).multiSelect({selectableOptgroup:!0,selectableHeader:"<input placeholder='Enter Name' type='text' class='form-control input-sm' autocomplete='off' style='text-transform:uppercase;margin-bottom:5px;'>",selectionHeader:"<input placeholder='Enter Name' type='text' class='form-control input-sm' autocomplete='off' style='text-transform:uppercase;margin-bottom:5px;'>",afterInit:function(e){var t=this,a=t.$selectableUl.prev(),l=t.$selectionUl.prev(),n="#"+t.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",r="#"+t.$container.attr("id")+" .ms-elem-selection.ms-selected";t.qs1=a.quicksearch(n).on("keydown",function(e){if(40===e.which)return t.$selectableUl.focus(),!1}),t.qs2=l.quicksearch(r).on("keydown",function(e){if(40==e.which)return t.$selectionUl.focus(),!1})},afterSelect:function(t){this.qs1.cache(),this.qs2.cache(),e.setVoters($(e.refs.selectBox).val())},afterDeselect:function(t){this.qs1.cache(),this.qs2.cache(),e.setVoters($(e.refs.selectBox).val())},cssClass:"fluid-size"})},loadVoters:function(){var e=this,t=e.state.form.data,a=$("#form-municipality-select2").val(),l=$("#form-barangay-select2").val();e.isEmpty(a)||e.isEmpty(l)||(e.requestVoters=$.ajax({url:Routing.generate("ajax_multiselect_voter",t),type:"GET"}).done(function(t){var a=e.state.form;a.data.voters=[],e.setState({votersList:t,unselected:t,form:a}),e.refreshSelectBox()}))},refreshSelectBox:function(){$(this.refs.selectBox).multiSelect("refresh")},deselectAll:function(){$(this.refs.selectBox).multiSelect("deselect_all")},selectAll:function(){$(this.refs.selectBox).multiSelect("select_all")},setVoters:function(e){var t=this.state.form,a=[];null!=e?(t.data.voters=e,a=this.state.votersList.filter(function(t){return-1==e.indexOf(t.voter_id)})):(t.data.voters=[],a=this.state.votersList),this.setState({form:t,unselected:a})},render:function(){var e=this,t=e.state.form.data;return React.createElement(Modal,{keyboard:!1,enforceFocus:!1,bsSize:"lg",backdrop:"static",show:this.props.show,onHide:this.props.onHide},React.createElement(Modal.Header,{className:"modal-header bg-blue-dark font-white",closeButton:!0},React.createElement(Modal.Title,null,"Approval Form")),React.createElement(Modal.Body,{bsClass:"modal-body overflow-auto"},React.createElement("form",{id:"voter-form",onSubmit:this.submit},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3"},React.createElement(FormGroup,{controlId:"formMunicipalityNo",validationState:this.getValidationState("municipalityNo")},React.createElement(ControlLabel,null," Municipality : "),React.createElement("select",{id:"form-municipality-select2",className:"form-control input-sm"}),React.createElement(HelpBlock,null,this.getError("municipalityNo")))),React.createElement("div",{className:"col-md-3"},React.createElement(FormGroup,{controlId:"formBarangayNo",validationState:this.getValidationState("brgyNo")},React.createElement(ControlLabel,null," Barangay : "),React.createElement("select",{id:"form-barangay-select2",className:"form-control input-sm"}),React.createElement(HelpBlock,null,this.getError("brgyNo")))),React.createElement("div",{className:"col-md-12 text-right"},React.createElement("div",{style:{margin:"5px 0 20px 0 "}},React.createElement("span",{style:{marginRight:"10px"}}," Voters : "),React.createElement("div",{className:"btn-group",style:{marginTop:"-6px"}},React.createElement("button",{type:"button",onClick:this.deselectAll,className:"btn btn-xs grey-steel"},"Deselect All"),React.createElement("button",{type:"button",onClick:this.selectAll,className:"btn btn-xs green-turquoise"},"Select All")))),React.createElement("div",{className:"col-md-12"},React.createElement("div",{className:"col-md-6",style:{marginLeft:"0",paddingLeft:"0"}},React.createElement("div",null," Available : ",this.state.unselected.length)),React.createElement("div",{className:"col-md-6 "},React.createElement("div",{style:{marginLeft:"30px"}}," Selected :  ",t.voters.length)),React.createElement(FormGroup,{controlId:"formVoters",validationState:this.getValidationState("totalRecords")},React.createElement("select",{multiple:!0,ref:"selectBox",className:"searchable",id:"voters",name:"voters[]"},this.state.votersList.map(function(e){return React.createElement("option",{key:e.hist_id,value:e.hist_id},e.voter_name)})),React.createElement("div",{className:"text-right"},React.createElement(HelpBlock,null,this.getError("totalRecords")))))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12 text-right"},React.createElement("button",{className:"btn btn-primary btn-sm",type:"submit"}," Submit "),React.createElement("button",{className:"btn btn-default btn-sm",type:"button",onClick:this.props.onHide}," Close "))))))}});window.VoterApprovalModal=VoterApprovalModal;var VoterDatatable=React.createClass({displayName:"VoterDatatable",getInitialState:function(){return{showApprovalModal:!1,showViewModal:!1,target:null,typingTimer:null,doneTypingInterval:1500,fiscalYears:[],summary:{recordsFiltered:0,obrTotal:0}}},componentDidMount:function(){this.gridTable(),this.initSelect2()},initSelect2:function(){var e=this;$("#voter_table #precinct_select2").select2({casesentitive:!1,placeholder:"Enter Precinct...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_precinct_no"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.precinct_no,text:e.precinct_no}})}}}}),$("#voter_table #municipality_select2").select2({casesentitive:!1,placeholder:"Enter Name...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_municipality"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.municipality_no,text:e.name}})}}}}),$("#voter_table #barangay_select2").select2({casesentitive:!1,placeholder:"Enter name...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_barangay"),data:function(e){return{searchText:e.term,municipalityNo:$("#voter_table #municipality_select2").val()}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.brgy_no,text:e.name}})}}}}),$("#voter_table #municipality_select2").on("change",function(){e.handleFilterChange()}),$("#voter_table #barangay_select2").on("change",function(){e.handleFilterChange()}),$("#voter_table #precinct_select2").on("change",function(){e.handleFilterChange()})},gridTable:function(){var e=this,t=new Datatable,a=$("#voter_table");t.init({src:a,onSuccess:function(t,a){var l=e.state.summary;l.recordsFiltered=a.recordsFiltered,l.obrTotal=a.obrTotal,console.log(a),e.setState({summary:l})},dataTable:{bState:!0,autoWidth:!0,serverSide:!0,processing:!0,deferRender:!0,ajax:{url:Routing.generate("ajax_datatable_voter_approval"),type:"GET",data:function(e){e.municipalityNo=$("#voter_table #municipality_select2").val(),e.brgyNo=$("#voter_table #barangay_select2").val(),e.precinctNo=$("#voter_table #precinct_select2").val(),e.voterName=$('#voter_table input[name="voter_name"]').val()}},columnDefs:[{className:"text-center valign-middle",orderable:!1,targets:[0,3,4,5,6,7,8]}],order:[[1,"asc"]],columns:[{data:null,className:"text-center",width:30,render:function(e,t,a,l){return l.settings._iDisplayStart+l.row+1}},{data:"voter_name"},{data:"precinct_no",className:"text-center",width:"80px"},{data:"municipality_name",width:"150px"},{data:"barangay_name",className:"text-center",width:"100px"},{data:null,className:"text-center",width:"30px",render:function(e,t,a){var l="";return l+=1==a.has_ast?"*":"",l+=1==a.has_a?"A":"",l+=1==a.has_b?"B":"",l+=1==a.has_c?"C":""}},{data:null,className:"text-center",width:"10px",render:function(e,t,a){var l="";return l+=1==a.is_1?"1,":"",l+=1==a.is_2?"2,":"",l+=1==a.is_3?"3,":"",l+=1==a.is_4?"4,":"",l+=1==a.is_5?"5,":"",l+=1==a.is_6?"6,":"",l+=1==a.is_7?"7,":"",l=l.slice(0,l.lastIndexOf(","))}},{data:"updated_at",width:"140px",className:"text-center",render:function(e){return moment(e).format("MM/DD/YYYY hh:mm A")}},{width:100,render:function(){var e='<button class="btn btn-xs blue-madison  approve-btn">Approve</button>';return e+='<button class="btn btn-xs green view-btn"><i class="fa fa-search"></i></button>'},className:"dt-body-center"}]}}),a.on("click",".edit-btn",function(){var a=t.getDataTable().row($(this).parents("tr")).data();e.approve(a.voter_id)}),a.on("click",".view-btn",function(){var a=t.getDataTable().row($(this).parents("tr")).data();e.view(a.voter_id)}),e.grid=t},openEntryModal:function(){console.log("open create modal"),this.setState({showEntryModal:!0})},openUploadModal:function(){this.setState({showUploadModal:!0})},approve:function(e){},view:function(e){this.setState({showViewModal:!0,target:e})},openApprovalModal:function(){this.setState({showApprovalModal:!0})},closeApprovalModal:function(){this.setState({showApprovalModal:!1}),this.reload()},closeViewModal:function(){this.setState({showViewModal:!1,target:null})},handleFilterChange:function(){var e=this;clearTimeout(this.state.typingTimer),this.state.typingTimer=setTimeout(function(){e.reload()},this.state.doneTypingInterval)},reload:function(){this.grid.getDataTable().ajax.reload()},render:function(){return React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement("button",{className:"btn btn-primary btn-sm",onClick:this.openApprovalModal},"Batch Approval")),React.createElement("div",{className:"col-md-6 text-right"},React.createElement("form",{onSubmit:this.onApplyCode},React.createElement("div",{className:"col-md-4 col-md-offset-5",style:{paddingRight:"0px"}},React.createElement("input",{type:"text",id:"input_access_code",onChange:this.setAccessCode,className:"form-control input-sm"})),React.createElement("div",{className:"col-md-3"},React.createElement("button",{type:"submit",className:"btn btn-primary btn-sm"},"Apply Code"))))),this.state.showApprovalModal&&React.createElement(VoterApprovalModal,{show:this.state.showApprovalModal,onHide:this.closeApprovalModal,notify:this.props.notify}),this.state.showViewModal&&React.createElement(VoterViewModal,{show:this.state.showViewModal,onHide:this.closeViewModal,notify:this.props.notify,voterId:this.state.target}),React.createElement("div",{className:"table-container"},React.createElement("div",{className:"table-actions-wrapper"},React.createElement("span",null," ")),React.createElement("table",{id:"voter_table",className:"table table-striped table-bordered",width:"100%"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"No"),React.createElement("th",null,"Name"),React.createElement("th",null,"Precinct No"),React.createElement("th",null,"Municipality"),React.createElement("th",null,"Brgy"),React.createElement("th",null,"Status"),React.createElement("th",null,"Tag"),React.createElement("th",null,"Last Update"),React.createElement("th",null)),React.createElement("tr",null,React.createElement("td",null),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("input",{type:"text",className:"form-control form-filter input-sm",name:"voter_name",onChange:this.handleFilterChange})),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("select",{id:"precinct_select2",className:"form-control form-filter input-sm",name:"precinct_no"})),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("select",{id:"municipality_select2",className:"form-control form-filter input-sm",name:"precinct_no"})),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("select",{id:"barangay_select2",className:"form-control form-filter input-sm",name:"precinct_no"})),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null))),React.createElement("tbody",null))))},setAccessCode:function(e){this.setState({accessCode:e.target.value})},onApplyCode:function(e){console.log("apply code"),e.preventDefault();var t=this;t.requestApplyCode=$.ajax({url:Routing.generate("ajax_apply_access_code",{accessCode:this.state.accessCode}),type:"GET"}).done(function(e){t.reload(),console.log("codes has been applied")}).fail(function(){console.log("invalid code")})}});window.VoterDatatable=VoterDatatable;var VoterComponent=React.createClass({displayName:"VoterComponent",notify:function(e,t){$.notific8("zindex",11500),$.notific8(e,{heading:"System Message",color:t,life:5e3,verticalEdge:"right",horizontalEdge:"top"})},render:function(){return React.createElement("div",{className:"portlet light portlet-fit bordered"},React.createElement("div",{className:"portlet-body"},React.createElement(VoterDatatable,{notify:this.notify})))}});setTimeout(function(){ReactDOM.render(React.createElement(VoterComponent,null),document.getElementById("voter-container"))},500);