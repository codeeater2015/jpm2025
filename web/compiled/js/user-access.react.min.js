var Modal=ReactBootstrap.Modal,FormGroup=ReactBootstrap.FormGroup,HelpBlock=ReactBootstrap.HelpBlock,ControlLabel=ReactBootstrap.ControlLabel,FormControl=ReactBootstrap.FormControl,UserAccessCreateModal=React.createClass({displayName:"UserAccessCreateModal",getInitialState:function(){return{form:{data:{provinceCode:"",municipalityNo:"",brgyNo:"",userId:null},errors:[]}}},render:function(){return React.createElement(Modal,{style:{marginTop:"10px"},keyboard:!1,enforceFocus:!1,bsSize:"sm",backdrop:"static",show:this.props.show,onHide:this.props.onHide},React.createElement(Modal.Header,{className:"modal-header bg-blue-dark font-white",closeButton:!0},React.createElement(Modal.Title,null,"Add Permission")),React.createElement(Modal.Body,{bsClass:"modal-body overflow-auto"},React.createElement("form",{id:"access-form"},React.createElement("div",{class:"row"},React.createElement("div",{className:"col-md-12"},React.createElement(FormGroup,{controlId:"formProvinceCode",validationState:this.getValidationState("provinceCode")},React.createElement(ControlLabel,null," Province  : "),React.createElement("select",{id:"form-province-select2",className:"form-control input-sm"}),React.createElement(HelpBlock,null,this.getError("provinceCode")))),React.createElement("div",{className:"col-md-12"},React.createElement(FormGroup,{controlId:"formMunicipalityNo",validationState:this.getValidationState("municipalityNo")},React.createElement(ControlLabel,null," City / Municipality : "),React.createElement("select",{id:"form-municipality-select2",className:"form-control input-sm"}),React.createElement(HelpBlock,null,this.getError("municipalityNo")))),React.createElement("div",{className:"col-md-12"},React.createElement(FormGroup,{controlId:"formBarangayNo",validationState:this.getValidationState("brgyNo")},React.createElement(ControlLabel,null," Barangay : "),React.createElement("select",{id:"form-barangay-select2",className:"form-control input-sm"}),React.createElement(HelpBlock,null,this.getError("brgyNo"))))),React.createElement("div",{class:"row"},React.createElement("div",{className:"text-right col-md-12"},React.createElement("button",{type:"button",className:"btn  btn-default",style:{marginRight:"5px"},onClick:this.props.onHide},"Close"),React.createElement("button",{type:"button",className:"btn blue-madison",onClick:this.submit},"Submit"))))))},componentDidMount:function(){this.initSelect2(),this.loadUser(this.props.userId)},loadUser:function(e){var t=this;t.requestUser=$.ajax({url:Routing.generate("ajax_get_user",{id:e}),type:"GET"}).done(function(e){var a=t.state.form;a.data.provinceCode=e.province.provinceCode,t.setState({form:a},t.reinitSelect2)})},initSelect2:function(){var e=this;$("#form-province-select2").select2({casesentitive:!1,placeholder:"Enter Province ...",allowClear:!0,delay:1500,width:"100%",disabled:!0,containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_province"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.province_code,text:e.name}})}}}}),$("#form-municipality-select2").select2({casesentitive:!1,placeholder:"Enter Name ...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_municipality"),data:function(t){return{searchText:t.term,provinceCode:e.state.form.data.provinceCode}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.municipality_no,text:e.name}})}}}}),$("#form-barangay-select2").select2({casesentitive:!1,placeholder:"Enter name...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_barangay"),data:function(t){return{searchText:t.term,municipalityNo:$("#form-municipality-select2").val(),provinceCode:e.state.form.data.provinceCode}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.brgy_no,text:e.name}})}}}}),$("#form-province-select2").on("change",function(){$("#form-municipality-select2").empty().trigger("change"),$("#form-barangay-select2").empty().trigger("change"),e.setFormPropValue("provinceCode",$(this).val())}),$("#form-municipality-select2").on("change",function(){$("#form-barangay-select2").empty().trigger("change"),e.setFormPropValue("municipalityNo",$(this).val())}),$("#form-barangay-select2").on("change",function(){e.setFormPropValue("brgyNo",$(this).val())})},reinitSelect2:function(){var e=this,t=e.state.form.data.provinceCode;e.requestProvince=$.ajax({url:Routing.generate("ajax_get_province",{provinceCode:t}),type:"GET"}).done(function(e){console.log("setting default province"),console.log(e),$("#form-province-select2").empty().append($("<option/>").val(e.province_code).text(e.name)).trigger("change")})},setFormPropValue:function(e,t){var a=this.state.form;a.data[e]=t,this.setState({form:a})},setFormProp:function(e){var t=this.state.form;t.data[e.target.name]=e.target.value,this.setState({form:t})},setErrors:function(e){var t=this.state.form;t.errors=e,this.setState({form:t})},getError:function(e){var t=this.state.form.errors;for(var a in t)if(a==e)return t[e];return null},getValidationState:function(e){return null!=this.getError(e)?"error":""},isEmpty:function(e){return null==e||""==e},reset:function(){var e=this.state.form;e.data.brgyNo="",e.errors=[],$("#form-barangay-select2").empty().trigger("change"),this.setState({form:e})},submit:function(e){e.preventDefault();var t=this,a=t.state.form.data;t.requestPost=$.ajax({url:Routing.generate("ajax_post_user_access",{userId:t.props.userId}),data:a,type:"POST"}).done(function(e){t.reset(),t.props.reload()}).fail(function(e){t.props.notify("Form Validation Failed.","ruby"),t.setErrors(e.responseJSON)})}});window.UserAccessCreateModal=UserAccessCreateModal;var UserAccessDatatable=React.createClass({displayName:"UserAccessDatatable",getInitialState:function(){return{showCreateModal:!1,target:null,typingTimer:null,doneTypingInterval:1500}},componentDidMount:function(){this.initDatatable(),this.initSelect2()},initSelect2:function(){var e=this;$("#user_access_table #province_select2").select2({casesentitive:!1,placeholder:"Enter Name..",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_province"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.province_code,text:e.name}})}}}}),$("#user_access_table #municipality_select2").select2({casesentitive:!1,placeholder:"Enter Name...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_municipality"),data:function(e){return{searchText:e.term,provinceCode:$("#user_access_table #province_select2").val()}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.municipality_no,text:e.name}})}}}}),$("#user_access_table #barangay_select2").select2({casesentitive:!1,placeholder:"Enter name...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_barangay"),data:function(e){return{searchText:e.term,municipalityNo:$("#user_access_table #municipality_select2").val()}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.brgy_no,text:e.name}})}}}}),$("#user_access_table #province_select2").on("change",function(){e.handleFilterChange()}),$("#user_access_table #municipality_select2").on("change",function(){e.handleFilterChange()}),$("#user_access_table #barangay_select2").on("change",function(){e.handleFilterChange()})},initDatatable:function(){var e=this,t=$("#user_access_table"),a=new Datatable,n=Routing.generate("ajax_get_datatable_users_access_list",{userId:e.props.userId},!0);a.init({src:t,loadingMessage:"Loading...",dataTable:{bState:!0,autoWidth:!0,deferRender:!0,ajax:{url:n,type:"GET",data:function(e){e.provinceCode=$("#user_access_table #province_select2").val(),e.municipalityNo=$("#user_access_table #municipality_select2").val(),e.brgyNo=$("#user_access_table #barangay_select2").val()}},columnDefs:[{orderable:!1,targets:[0,3,4,5]}],order:[[0,"desc"]],columns:[{data:null,className:"text-center",width:30,render:function(e,t,a,n){return n.settings._iDisplayStart+n.row+1}},{data:"province_name"},{data:"municipality_name"},{data:"brgy_name"},{data:"valid_until",render:function(e,t,a){return moment(e).format("MMM DD, YYYY hh:mm A")}},{width:20,render:function(e,t,a){return"YES"===a.isDefault?"<span class='badge badge-info'>Default</span>":"<a href='javascript:void(0);' class='btn btn-xs btn-danger user-permission-button' data-toggle='tooltip' data-title='Delete'><i class='fa fa-trash' ></i></a>"}}]}}),t.on("click",".user-permission-button",function(){var t=a.getDataTable().row($(this).parents("tr")).data();e.delete(t.access_id)}),e.grid=a},delete:function(e){var t=this;confirm("Are you sure you want to delete this access?")&&(t.requestDelete=$.ajax({url:Routing.generate("ajax_delete_user_access",{accessId:e}),type:"DELETE"}).done(function(){t.reload()}))},handleFilterChange:function(){var e=this;clearTimeout(this.state.typingTimer),this.state.typingTimer=setTimeout(function(){e.reload()},this.state.doneTypingInterval)},reload:function(){this.grid.getDataTable().ajax.reload()},openCreateModal:function(){this.setState({showCreateModal:!0})},closeCreateModal:function(){this.setState({showCreateModal:!1})},render:function(){return React.createElement("div",{style:{marginTop:"10px"}},React.createElement("button",{type:"button",className:"btn btn-primary btn-xs",onClick:this.openCreateModal},"Add Access"),this.state.showCreateModal&&React.createElement(UserAccessCreateModal,{show:this.state.showCreateModal,onHide:this.closeCreateModal,userId:this.props.userId,notify:this.props.notify,reload:this.reload}),React.createElement("div",{className:"table-container"},React.createElement("div",{className:"table-actions-wrapper"},React.createElement("span",null," ")),React.createElement("table",{id:"user_access_table",className:"table table-striped table-bordered",width:"100%"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"No"),React.createElement("th",null,"Province"),React.createElement("th",null,"Municipality"),React.createElement("th",null,"Barangay"),React.createElement("th",null,"Valid Until"),React.createElement("th",null,"Action")),React.createElement("tr",null,React.createElement("td",null),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("select",{id:"province_select2",className:"form-control form-filter input-sm",name:"provinceCode"})),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("select",{id:"municipality_select2",className:"form-control form-filter input-sm",name:"municipalityNo"})),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("select",{id:"barangay_select2",className:"form-control form-filter input-sm",name:"brgyNo"})),React.createElement("td",null),React.createElement("td",null))),React.createElement("tbody",null))))}});window.UserAccessDatatable=UserAccessDatatable;var Modal=ReactBootstrap.Modal,UserAccessModal=React.createClass({displayName:"UserAccessModal",getInitialState:function(){return{showCreateModal:!1,numDays:1,generated:!1,user:{validUntil:null}}},componentDidMount:function(){this.loadUser(this.props.userId)},loadUser:function(e){var t=this;t.requestUser=$.ajax({url:Routing.generate("ajax_get_user",{id:e}),type:"GET"}).done(function(e){console.log("user has been received"),console.log(e),t.setState({user:e})})},render:function(){var e=this;return React.createElement(Modal,{keyboard:!1,enforceFocus:!1,bsSize:"lg",backdrop:"static",show:this.props.show,onHide:this.props.onHide},React.createElement(Modal.Header,{className:"modal-header bg-blue-dark font-white",closeButton:!0},React.createElement(Modal.Title,null,"User Access Permissions")),React.createElement(Modal.Body,{bsClass:"modal-body overflow-auto"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-4"},React.createElement("div",{className:"form-group"},React.createElement("input",{type:"text",value:e.state.user.accessCode,placeholder:"No code was generated.",name:"accessCode",onChange:"",className:"form-control input-sm"})),React.createElement("div",{style:{margin:"0px",padding:"0px"}},React.createElement("small",null),React.createElement("small",null,"Valid Until : ",e.state.user.validUntil?moment(e.state.user.validUntil).format("MMM DD, YYYY hh:mm:ss A"):"- - - - -"," "))),React.createElement("div",{className:"col-md-2"},React.createElement("div",{className:"form-group"},React.createElement("input",{type:"number",value:this.state.numDays,onChange:this.setNumDays,placeholder:"days",min:"1",max:"100",className:"form-control input-sm"}))),React.createElement("div",{className:"col-md-1"},React.createElement("button",{className:"btn btn-detault btn-sm",onClick:this.generateCode},"Generate")),React.createElement("div",{className:"col-md-1",style:{marginLeft:"5px"}},React.createElement("button",{className:"btn btn-success btn-sm",disabled:!this.state.generated,onClick:this.activate},"Activate")),React.createElement("div",{className:"col-md-1",style:{marginLeft:"10px"}},React.createElement("button",{className:"btn btn-danger btn-sm",onClick:this.clear},"Remove All Access"))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement(UserAccessDatatable,{ref:"datatable",notify:this.props.notify,userId:this.props.userId})))))},setNumDays:function(e){this.setState({numDays:e.target.value})},generateCode:function(){var e=this;e.requestCode=$.ajax({url:Routing.generate("ajax_generate_access_code",{id:e.props.userId,numDays:this.state.numDays}),type:"GET"}).done(function(t){e.loadUser(e.props.userId),e.setState({generated:!0})})},reloadDatatable:function(){this.refs.datatable.reload()},activate:function(){var e=this;e.requestCode=$.ajax({url:Routing.generate("ajax_activate_access_code",{id:e.props.userId}),type:"POST"}).done(function(t){alert("Data access has been activated.."),e.reloadDatatable()})},clear:function(){var e=this;e.requestCode=$.ajax({url:Routing.generate("ajax_clear_access",{id:e.props.userId}),type:"POST"}).done(function(t){e.reloadDatatable()})}});window.UserAccessModal=UserAccessModal;var UserDatatable=React.createClass({displayName:"UserDatatable",getInitialState:function(){return{showAccessModal:!1,target:null,typingTimer:null,doneTypingInterval:1500}},componentDidMount:function(){this.initDatatable()},initDatatable:function(){var e=this,t=(new Datatable,$("#user_table")),a=new Datatable,n=Routing.generate("ajax_get_datatable_users_list",{},!0);a.init({src:t,loadingMessage:"Loading...",dataTable:{bState:!0,autoWidth:!0,deferRender:!0,ajax:{url:n,type:"GET"},columnDefs:[{orderable:!1,targets:[0,2,3,4,5,6,7]},{className:"align-center",targets:[0,3,4,5,6,7]}],order:[[0,"desc"]],columns:[{data:null,className:"text-center",width:30,render:function(e,t,a,n){return n.settings._iDisplayStart+n.row+1}},{data:"name"},{data:"username",render:function(e){return'<a href="'+Routing.generate("homepage",{},!0)+"?_switch_user="+e+'">'+e+"</a>"}},{data:"gender"},{data:"groupName"},{data:"provinceName",width:100},{data:"groupId",className:"text-center",render:function(e,t,a){return 1==e?"END OF TIME":null==a.validUntil?"NOT SET":moment(a.validUntil).format("MMM DD YYYY hh:mm:ss A")}},{render:function(e,t,a){return"YES"===a.isDefault?"<span class='badge badge-info'>Default</span>":"<a href='javascript:void(0);' class='btn btn-xs font-white bg-green-dark user-permission-button' data-toggle='tooltip' data-title='Change Password'><i class='fa fa-lock' ></i></a>"}}]}}),t.on("click",".user-permission-button",function(){var t=a.getDataTable().row($(this).parents("tr")).data();e.setState({showAccessModal:!0,target:t.id})}),e.grid=a},closeAccessModal:function(){this.setState({showAccessModal:!1,target:null})},handleFilterChange:function(){var e=this;clearTimeout(this.state.typingTimer),this.state.typingTimer=setTimeout(function(){e.reload()},this.state.doneTypingInterval)},reload:function(){this.grid.getDataTable().ajax.reload()},render:function(){return React.createElement("div",null,this.state.showAccessModal&&React.createElement(UserAccessModal,{show:this.state.showAccessModal,onHide:this.closeAccessModal,userId:this.state.target,notify:this.props.notify}),React.createElement("div",{className:"table-container"},React.createElement("div",{className:"table-actions-wrapper"},React.createElement("span",null," ")),React.createElement("table",{id:"user_table",className:"table table-striped table-bordered",width:"100%"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"No"),React.createElement("th",null,"Name"),React.createElement("th",null,"Username"),React.createElement("th",null,"Gender"),React.createElement("th",null,"Group"),React.createElement("th",null,"Province"),React.createElement("th",null,"Valid Until"),React.createElement("th",null)),React.createElement("tr",null,React.createElement("td",null),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("input",{type:"text",className:"form-control form-filter input-sm",name:"idx_no",onChange:this.handleFilterChange})),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null))),React.createElement("tbody",null))))}});window.UserDatatable=UserDatatable;var UserAccessComponent=React.createClass({displayName:"UserAccessComponent",notify:function(e,t){$.notific8("zindex",11500),$.notific8(e,{heading:"System Message",color:t,life:5e3,verticalEdge:"right",horizontalEdge:"top"})},render:function(){return React.createElement("div",{className:"portlet light portlet-fit bordered"},React.createElement("div",{className:"portlet-body"},React.createElement(UserDatatable,{notify:this.notify})))}});setTimeout(function(){ReactDOM.render(React.createElement(UserAccessComponent,null),document.getElementById("user-access-container"))},500);