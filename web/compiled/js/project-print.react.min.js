var Modal=ReactBootstrap.Modal,FormGroup=ReactBootstrap.FormGroup,HelpBlock=ReactBootstrap.HelpBlock,ControlLabel=ReactBootstrap.ControlLabel,FormControl=ReactBootstrap.FormControl,PrintingGroupModal=React.createClass({displayName:"PrintingGroupModal",getInitialState:function(){return{printMode:"EVENT",profileEndpoint:"",municipalityName:"",brgyNo:"",unselected:[],options:[],form:{data:{profiles:[]},errors:[]}}},componentDidMount:function(){this.initComponents(),this.initSelect2()},componentWillUnmount:function(){this.isEmpty(this.requestProfiles)||this.requestProfiles.abort()},initSelect2:function(){console.log("initialize select2");var e=this;$("#print-municipality-select2").select2({casesentitive:!1,placeholder:"Enter municipality...",width:"100%",allowClear:!0,tags:!0,containerCssClass:":all:",createTag:function(e){return{id:e.term,text:e.term,newOption:!0}},ajax:{url:Routing.generate("ajax_select2_municipality"),data:function(e){return{searchText:e.term,provinceCode:53}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.name,text:e.name}})}}}}),$("#print-barangay-select2").select2({casesentitive:!1,placeholder:"Enter name...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_barangay_alt"),data:function(e){return{searchText:e.term,provinceCode:53,municipalityName:$("#print-municipality-select2").val()}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.brgy_no,text:e.name}})}}}}),$("#print-municipality-select2").on("change",function(){$("#print-barangay-select2").empty().trigger("change"),e.setState({municipalityName:$(this).val()},e.loadProfiles)}),$("#print-barangay-select2").on("change",function(){e.setState({brgyNo:$(this).val()},e.loadProfiles)})},loadProfiles:function(){var e=this;e.requestProfiles=$.ajax({url:e.state.profileEndpoint,data:{municipalityName:this.state.municipalityName,brgyNo:this.state.brgyNo},type:"GET"}).done(function(t){e.setState({options:t,unselected:t}),setTimeout(e.refreshSelectBox,2e3)})},initComponents:function(){this.initProfileEndpoint(this.state.printMode),this.initMultiSelect()},initProfileEndpoint:function(e){var t="";switch(e){case"EVENT":t=Routing.generate("ajax_get_active_event_voter_no_id",{proId:this.props.proId,electId:this.props.electId});break;case"JTR":t=Routing.generate("ajax_get_project_voter_jpm_jtr_no_id",{proId:this.props.proId,electId:this.props.electId});break;default:t=Routing.generate("ajax_get_project_voter_no_id",{proId:this.props.proId,electId:this.props.electId})}this.setState({profileEndpoint:t},this.loadProfiles)},initMultiSelect:function(){var e=this,t=this.refs.selectBox;$(t).multiSelect({selectableOptgroup:!0,selectableHeader:"<input placeholder='Enter Name' type='text' class='form-control' autocomplete='off' style='text-transform:uppercase;margin-bottom:5px;'>",selectionHeader:"<input placeholder='Enter Name' type='text' class='form-control' autocomplete='off' style='text-transform:uppercase;margin-bottom:5px;'>",afterInit:function(e){var t=this,n=t.$selectableUl.prev(),a=t.$selectionUl.prev(),r="#"+t.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",i="#"+t.$container.attr("id")+" .ms-elem-selection.ms-selected";t.qs1=n.quicksearch(r).on("keydown",function(e){if(40===e.which)return t.$selectableUl.focus(),!1}),t.qs2=a.quicksearch(i).on("keydown",function(e){if(40==e.which)return t.$selectionUl.focus(),!1})},afterSelect:function(t){this.qs1.cache(),this.qs2.cache(),e.setProfiles($(e.refs.selectBox).val())},afterDeselect:function(t){this.qs1.cache(),this.qs2.cache(),e.setProfiles($(e.refs.selectBox).val())},cssClass:"fluid-size"})},refreshSelectBox:function(){$(this.refs.selectBox).multiSelect("refresh")},deselectAll:function(){$(this.refs.selectBox).multiSelect("deselect_all")},selectAll:function(){$(this.refs.selectBox).multiSelect("select_all")},setProfiles:function(e){var t=this.state.form,n=[];null!=e?(t.data.profiles=e,n=this.state.options.filter(function(t){return-1==e.indexOf(t.profile_no)})):(t.data.profiles=[],n=this.state.options),this.setState({form:t,unselected:n})},setPrintMode:function(e){e.target.checked&&this.setState({printMode:e.target.value},this.initProfileEndpoint(e.target.value))},setFormProp:function(e){var t=this.state.form;t.data[e.target.name]=e.target.value,this.setState({form:t})},setErrors:function(e){var t=this.state.form;t.errors=e,this.setState({form:t})},getError:function(e){var t=this.state.form.errors;for(var n in t)if(n==e)return t[e];return null},getValidationState:function(e){return null!=this.getError(e)?"error":null},submit:function(e){e.preventDefault();var t=this,n=t.state.form.data;n.printOrigin="GENERIC",t.requestTransmit=$.ajax({url:Routing.generate("ajax_post_project_print",{proId:this.props.proId}),type:"POST",data:n}).done(function(e){t.props.onHide()}).fail(function(e){t.setErrors(e.responseJSON)})},popupCenter:function(e,t,n,a){var r=void 0!=window.screenLeft?window.screenLeft:screen.left,i=void 0!=window.screenTop?window.screenTop:screen.top,o=0,l=0;o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,l=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var c=o/2-n/2+r,s=l/2-a/2+i,d=window.open(e,t,"scrollbars=yes, width="+n+", height="+a+", top="+s+", left="+c);window.focus&&d.focus()},isEmpty:function(e){return null==e||""==e},render:function(){return React.createElement(Modal,{enforceFocus:!1,backdrop:"static",dialogClassName:"modal-custom-85",show:this.props.show,onHide:this.props.onHide},React.createElement(Modal.Header,{closeButton:!0},React.createElement(Modal.Title,null,"Create Template")),React.createElement(Modal.Body,{bsClass:"modal-body overflow-auto"},React.createElement("form",{onSubmit:this.submit},React.createElement("div",{className:"col-md-4 no-padding"},React.createElement("div",{className:"mt-radio-inline"},React.createElement("label",{className:"mt-radio"},React.createElement("input",{type:"radio",name:"printMode",onChange:this.setPrintMode,value:"EVENT",checked:"EVENT"==this.state.printMode})," Active Event",React.createElement("span",null)),React.createElement("label",{className:"mt-radio"},React.createElement("input",{type:"radio",name:"printMode",onChange:this.setPrintMode,value:"JTR",checked:"JTR"==this.state.printMode})," JPM-JTR",React.createElement("span",null)),React.createElement("label",{className:"mt-radio"},React.createElement("input",{type:"radio",name:"printMode",onChange:this.setPrintMode,value:"ALL",checked:"ALL"==this.state.printMode})," All",React.createElement("span",null)))),React.createElement("div",{className:"clearfix"}),React.createElement("div",{className:"col-md-3 no-padding"},React.createElement(FormGroup,{controlId:"formBarangayNo"},React.createElement(ControlLabel,null," Municipality : "),React.createElement("select",{id:"print-municipality-select2",className:"form-control input-sm"}))),React.createElement("div",{className:"col-md-3"},React.createElement(FormGroup,{controlId:"formBarangayNo"},React.createElement(ControlLabel,null," Barangay : "),React.createElement("select",{id:"print-barangay-select2",className:"form-control input-sm"}))),React.createElement("div",{className:"clearfix"}),React.createElement("div",{className:"col-md-12 no-padding"},React.createElement("div",{className:"text-right"},React.createElement("button",{type:"button",onClick:this.deselectAll,className:"btn btn-xs btn-default",style:{marginRight:"5px"}},"Deselect All"),React.createElement("button",{type:"button",onClick:this.selectAll,className:"btn btn-xs btn-success"},"Select All"))),React.createElement("div",{className:"clearfix"}),React.createElement("div",{className:"col-md-6 no-padding"},React.createElement("div",null,React.createElement("strong",null,"Available :")," ",this.state.unselected.length)),React.createElement("div",{className:"col-md-6 "},React.createElement("div",{style:{marginLeft:"32px"}},React.createElement("strong",null,"Selected : ")," ",this.state.form.data.profiles.length)),React.createElement(FormGroup,{controlId:"formProfiles",validationState:this.getValidationState("profiles")},React.createElement("select",{multiple:!0,ref:"selectBox",className:"searchable",id:"contracts",name:"profiles[]"},this.state.options.map(function(e){return React.createElement("option",{key:e.pro_voter_id,value:e.pro_voter_id},e.voter_name," (",e.voter_group,") - ",e.barangay_name," - ",e.generated_id_no)})),React.createElement("div",{className:"text-right"},React.createElement(HelpBlock,null,this.getError("profiles")))),React.createElement("div",{className:"clearfix"}),React.createElement("div",{className:"text-right m-t-md"},React.createElement("button",{type:"button",className:"btn btn-default",onClick:this.props.onHide},"Cancel"),React.createElement("button",{type:"submit",className:"btn btn-primary"},"Submit")))))}});window.PrintingGroupModal=PrintingGroupModal;var PrintDatatable=React.createClass({displayName:"PrintDatatable",render:function(){return React.createElement("div",null,React.createElement("table",{id:"print-table",className:"table table-bordered"},React.createElement("thead",null,React.createElement("tr",{className:"text-center"},React.createElement("td",null,"ID"),React.createElement("td",null,"Origin"),React.createElement("td",null,"Description"),React.createElement("td",null,"Created By"),React.createElement("td",null,"Date Created"),React.createElement("td",null,"ID Count"),React.createElement("td",null))),React.createElement("tbody",null)))},componentDidMount:function(){this.initGrid()},initGrid:function(){var e=new Datatable,t=this;e.init({src:$("#print-table"),dataTable:{ordering:!1,serverSide:!0,processing:!0,searching:!1,deferRender:!0,autoWidth:!0,dom:'<"top"fpli>rt<"bottom"pli><"clear">',searchDelay:2e3,language:{processing:'<i class="fa fa-spinner fa-pulse fa-fw"></i><span > Loading...</span>.'},lengthMenu:[[10,20,50,100,150],[10,20,50,100,150]],pageLength:10,ajax:{url:Routing.generate("ajax_get_project_print",{proId:this.props.proId}),type:"GET"},columns:[{data:"print_id",className:"text-center",width:50},{data:"print_origin",className:"text-center"},{data:"print_desc",className:"text-center"},{data:"entry_by",className:"text-center"},{data:"print_date",className:"text-center",width:150},{data:"total_members",width:80,className:"text-center"},{width:100,className:"text-center",render:function(e,t,n){var a='<div class="btn-group"><button type="button" class="btn btn-xs blue">Actions</button><button type="button" class="btn btn-xs blue dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="1000" data-close-others="true"><i class="fa fa-angle-down"></i></button><ul class="dropdown-menu" role="menu">';return a+='<li><a href="javascript:;" class="jpm-btn-pdf"><i class="fa fa-file-pdf-o"></i>JPM</a></li>',a+='<li><a href="javascript:;" class="jpm-alt-btn-pdf"><i class="fa fa-file-pdf-o"></i>JPM Alt</a></li>',a+='<li><a href="javascript:;" class="btn-delete"><i class="fa fa-trash"></i> Delete </a></li>',a+="</ul></div>"}}]}}),$("#print-table tbody").on("click",".jpm-btn-pdf",function(){var n=e.getDataTable().row($(this).parents("tr")).data();t.showPrintout(n.print_id)}),$("#print-table tbody").on("click",".jpm-alt-btn-pdf",function(){var n=e.getDataTable().row($(this).parents("tr")).data();t.showPrintoutAlt(n.print_id)}),$("#print-table tbody").on("click",".btn-delete",function(){var n=e.getDataTable().row($(this).parents("tr")).data();t.deletePrintout(n.print_id)}),t.grid=e},initSelect2:function(){var e=this;$.fn.select2.defaults.set("theme","bootstrap"),$("#print-table .rcenter-select2").select2({casesentitive:!1,placeholder:"Enter text...",allowClear:!0,tags:!0,createTag:function(e){return{id:e.term,text:e.term,newOption:!0}},ajax:{url:Routing.generate("cos_api_select2_rcenters"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.rc_code,text:e.rc_desc}})}}}}),$("#transmittal-table .rcenter-select2").on("change",function(){e.handleFilterChange()})},deletePrintout:function(e){var t=this;bootbox.confirm("Are you sure you want to delete this template?",function(n){n&&(t.requestDelete=$.ajax({url:Routing.generate("ajax_delete_project_print",{printId:e}),type:"DELETE"}).done(function(e){t.reload()}))})},handleFilterChange:function(){var e=this;clearTimeout(this.state.typingTimer),this.state.typingTimer=setTimeout(function(){e.reload()},this.state.doneTypingInterval)},reload:function(){this.grid.getDataTable().ajax.reload()},showPrintout:function(e){var t="http://"+window.reportIp+"/jpm/index.php?print_id="+e;this.popupCenter(t,"ID Group Template",900,600)},showPrintoutAlt:function(e){var t="http://"+window.reportIp+"/jpm/alt-id/index.php?print_id="+e;this.popupCenter(t,"ID Group Template",900,600)},popupCenter:function(e,t,n,a){var r=void 0!=window.screenLeft?window.screenLeft:screen.left,i=void 0!=window.screenTop?window.screenTop:screen.top,o=0,l=0;o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,l=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var c=o/2-n/2+r,s=l/2-a/2+i,d=window.open(e,t,"scrollbars=yes, width="+n+", height="+a+", top="+s+", left="+c);window.focus&&d.focus()}});window.PrintDatatable=PrintDatatable;var RescuePrintingSection=React.createClass({displayName:"RescuePrintingSection",getInitialState:function(){return{showGroupingModal:!1,filters:{electId:null,provinceCode:null,proId:null}}},componentDidMount:function(){$(document).ajaxError(function(e,t,n){switch(t.status){case 400:window.services.growl.notify("Form Submission failed.","danger");break;case 403:window.services.growl.notify("Action denied.You are not allowed to perform this action.","danger");break;case 500:window.services.growl.notify("Opps. Something went wrong in the server. Please inform the system administrator.","danger")}}),this.loadUser(window.userId),this.initSelect2()},render:function(){return React.createElement("div",{className:"portlet light bordered overflow-auto"},React.createElement("div",{className:"portlet-body"},React.createElement("div",{className:"col-md-6"},React.createElement("h3",{className:"h3 m-b-md"},"ID Maker"),React.createElement("button",{type:"button",className:"btn green",onClick:this.openGroupingModal},"Create Template")),React.createElement("div",{className:"col-md-6"},React.createElement("form",{onSubmit:this.onApplyCode},React.createElement("div",{className:"col-md-3 col-md-offset-1"},React.createElement("select",{id:"election_select2",className:"form-control form-filter input-sm"})),React.createElement("div",{className:"col-md-4"},React.createElement("select",{id:"province_select2",className:"form-control form-filter input-sm"})),React.createElement("div",{className:"col-md-4"},React.createElement("select",{id:"project_select2",className:"form-control form-filter input-sm"})))),this.state.showGroupingModal&&React.createElement(PrintingGroupModal,{proId:this.state.filters.proId,electId:this.state.filters.electId,provinceCode:this.state.filters.provinceCode,show:this.state.showGroupingModal,onHide:this.closeGroupingModal}),React.createElement("div",{className:"col-md-12"},React.createElement(PrintDatatable,{ref:"datatable",proId:this.state.filters.proId}))))},openGroupingModal:function(){this.setState({showGroupingModal:!0})},closeGroupingModal:function(){this.setState({showGroupingModal:!1}),this.refs.datatable.reload()},loadUser:function(e){var t=this;t.requestUser=$.ajax({url:Routing.generate("ajax_get_user",{id:e}),type:"GET"}).done(function(e){t.setState({user:e},t.reinitSelect2)})},initSelect2:function(){var e=this;$("#election_select2").select2({casesentitive:!1,placeholder:"Select Election...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_elections"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.elect_id,text:e.elect_name}})}}}}),$("#project_select2").select2({casesentitive:!1,placeholder:"Select Project...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_projects"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.pro_id,text:e.pro_name}})}}}}),$("#province_select2").select2({casesentitive:!1,placeholder:"Enter Province...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_province_strict"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.province_code,text:e.name}})}}}}),$("#election_select2").on("change",function(){var t=e.state.filters;t.electId=$(this).val(),e.setState({filters:t},e.reload)}),$("#project_select2").on("change",function(){var t=e.state.filters;t.proId=$(this).val(),e.setState({filters:t},e.reload)}),$("#province_select2").on("change",function(){var t=e.state.filters;t.provinceCode=$(this).val(),e.setState({filters:t},e.reload)})},reinitSelect2:function(){var e=this;if(!e.isEmpty(e.state.user.project)){var t=e.state.user.project.provinceCode;e.requestProvince=$.ajax({url:Routing.generate("ajax_get_province",{provinceCode:t}),type:"GET"}).done(function(e){$("#province_select2").empty().append($("<option/>").val(e.province_code).text(e.name)).trigger("change")}),e.requestProject=$.ajax({url:Routing.generate("ajax_get_project",{proId:e.state.user.project.proId}),type:"GET"}).done(function(e){$("#project_select2").empty().append($("<option/>").val(e.proId).text(e.proName)).trigger("change")})}e.requestActiveElection=$.ajax({url:Routing.generate("ajax_get_active_election"),type:"GET"}).done(function(e){$("#election_select2").empty().append($("<option/>").val(e.electId).text(e.electName)).trigger("change")}),e.state.user.isAdmin||($("#election_select2").attr("disabled","disabled"),$("#province_select2").attr("disabled","disabled"),$("#project_select2").attr("disabled","disabled"))},isEmpty:function(e){return null==e||""==e||"undefined"==e||e<=0}});window.RescuePrintingSection=RescuePrintingSection,setTimeout(function(){ReactDOM.render(React.createElement(RescuePrintingSection,null),document.getElementById("project-print-container"))},500);