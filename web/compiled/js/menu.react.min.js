var FormGroup=ReactBootstrap.FormGroup,ControlLabel=ReactBootstrap.ControlLabel,FormControl=ReactBootstrap.FormControl,HelpBlock=ReactBootstrap.HelpBlock,ItemForm=React.createClass({displayName:"ItemForm",getInitialState:function(){return{form:{errors:{},data:{menu_link:"",menu_label:"",menu_target:"",menu_type:"Custom",menu_icon:'<i class="fa fa-question"></i>'}}}},componentDidMount:function(){var e=this,t=$("#form-icon-picker");t.iconpicker({arrowClass:"btn-danger",arrowPrevIconClass:"glyphicon glyphicon-chevron-left",arrowNextIconClass:"glyphicon glyphicon-chevron-right",cols:6,footer:!0,header:!0,icon:"",iconset:"fontawesome",labelHeader:"{0} of {1} pages",labelFooter:"{0} - {1} of {2} icons",placement:"bottom",rows:5,search:!0,searchText:"Search",selectedClass:"btn-success"}),t.on("change",function(t){e.setMenuIcon(t)})},componentWillUnmount:function(){this.clear()},render:function(){return React.createElement("div",null,React.createElement("div",{className:"form-body"},React.createElement("form",null,React.createElement("div",{className:"clearfix"}),React.createElement(FormGroup,{controlId:"formLabel",validationState:this.getValidationState("menu_label")},React.createElement(ControlLabel,null,"Menu Title"),React.createElement(FormControl,{type:"text",value:this.state.form.data.menu_label,bsClass:"form-control input-xs",name:"menu_label",onChange:this.setMenuLabel}),React.createElement(HelpBlock,null,this.getError("menu_label"))),React.createElement("div",{className:"clearfix"}),React.createElement(FormGroup,{controlId:"formLink",validationState:this.getValidationState("menu_link")},React.createElement(ControlLabel,null,"Route"),React.createElement(FormControl,{type:"text",value:this.state.form.data.menu_link,bsClass:"form-control input-xs",name:"menu_link",onChange:this.setMenuLink}),React.createElement(HelpBlock,null,this.getError("menu_link"))),React.createElement("div",{className:"clearfix"}),React.createElement(FormGroup,{controlId:"formLabel",validationState:this.getValidationState("menu_target")},React.createElement(ControlLabel,null,"Target"),React.createElement(FormControl,{componentClass:"select",value:this.state.form.data.menu_target,bsClass:"form-control input-xs",name:"menu_target",onChange:this.setMenuTarget},React.createElement("option",{value:""},"Select Target"),React.createElement("option",{value:"none"},"None"),React.createElement("option",{value:"_blank"},"Blank"),React.createElement("option",{value:"_parent"},"Parent"),React.createElement("option",{value:"_self"},"Self"),React.createElement("option",{value:"_top"},"Top")),React.createElement(HelpBlock,null,this.getError("menu_target"))),React.createElement("div",{className:"clearfix"}),React.createElement(FormGroup,{controlId:"formIcon",validationState:this.getValidationState("menu_icon")},React.createElement(ControlLabel,null,"Icon"),React.createElement("div",{id:"form-icon-picker","data-search":"true","data-search-text":"Search...",role:"iconpicker"}),React.createElement(HelpBlock,null,this.getError("menu_icon"))))),React.createElement("div",{className:"form-actions right"},React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",style:{marginRight:"7px"},onClick:this.clear},"Clear"),React.createElement("button",{type:"button",className:"btn btn-sm btn-success",onClick:this.submit},"Add custom menu")))},submit:function(){var e=this.state.form.data,t=[];if(e.children=[],null==this.props.selectedGroup)return void bootbox.alert("Please select a group");""!=e.menu_label&&null!=e.menu_label||t.push({field:"menu_label",message:"This value cannot be blank"}),""!=e.menu_target&&null!=e.menu_target||t.push({field:"menu_target",message:"This value cannot be blank"}),t.length>0?this.setErrors(t):(console.log(e),this.props.addHandler([e]),this.clear())},clear:function(){this.setState(this.getInitialState,function(){$("#form-icon-picker").iconpicker("setIcon","empty")})},setMenuLabel:function(e){var t=this.state.form;t.data.menu_label=e.target.value,this.setState({form:t})},setMenuIcon:function(e){var t=this.state.form;t.data.menu_icon='<i class="fa '+e.icon+'" ></i>',this.setState({form:t})},setMenuTarget:function(e){var t=this.state.form;t.data.menu_target=e.target.value,this.setState({form:t})},setMenuLink:function(e){var t=this.state.form;t.data.menu_link=e.target.value,this.setState({form:t})},setErrors:function(e){var t=this.state.form;t.errors=e,this.setState({form:t})},getError:function(e){for(var t=this.state.form.errors,a=0;a<t.length;a++)if(t[a].field==e)return t[a].message;return null},getValidationState:function(e){return this.getError(e)?"error":null}});window.ItemForm=ItemForm;var Checkbox=ReactBootstrap.Checkbox,FormGroup=ReactBootstrap.FormGroup,ModuleList=React.createClass({displayName:"ModuleList",getInitialState:function(){return{items:[],selectedItems:[],selectAll:!1,targetItem:null,loading:!0}},componentDidMount:function(){this.getItems()},componentWillUnmount:function(){this.request.abort()},getItems:function(){var e=this,t=Routing.generate("ajax_get_menu_module",{},!0);this.request=$.ajax({url:t,type:"GET",beforeSend:function(){e.showLoading()}}).done(function(t){e.setState({items:t})}).fail(function(e){console.log(e)}).always(function(){e.hideLoading()})},showLoading:function(){this.setState({loading:!0})},hideLoading:function(){this.setState({loading:!1})},addToTree:function(e){this.setState({targetItem:e})},updateSelectedList:function(e,t){var a=this.state.selectedItems,n=this.inlist(e);t.target.checked?-1==n&&a.push(e):-1!=n&&a.splice(n,1),this.setState({selectedItems:a})},inlist:function(e){for(var t=this.state.selectedItems,a=0;a<t.length;a++)if(t[a].moduleName==e.moduleName)return a;return-1},add:function(){var e=this,t=[];if(null==this.props.selectedGroup||""==this.props.selectedGroup)return void bootbox.alert("Please select a group");e.state.selectedItems.map(function(e){t.push({menu_label:e.moduleLabel,menu_link:e.moduleRoute,menu_icon:e.moduleIcon,menu_target:"none",menu_type:"System",children:[]})}),e.props.addHandler(t),e.clear()},toggleSelect:function(){var e=this.state.selectAll,t=this.state.selectedItems;e=!e;for(var a in this.refs)this.refs[a].checked=e;t=e?this.state.items:[],this.setState({selectAll:e,selectedItems:t})},clear:function(){for(var e in this.refs)this.refs[e].checked=!1;this.setState({selectedItems:[],selectAll:!1})},render:function(){var e=this;return React.createElement("div",null,React.createElement("div",{className:"form-body"},React.createElement("div",{className:"scroller",style:{height:"250px"},"data-always-visible":"1","data-rail-visible":"0","data-rail-color":"red","data-handle-color":"green"},React.createElement("div",{className:"mt-checkbox-list"},e.state.items.map(function(t){return React.createElement("label",{key:t.id,className:"mt-checkbox mt-checkbox-outline"}," ",React.createElement("strong",null,React.createElement("span",{dangerouslySetInnerHTML:{__html:t.moduleIcon}})," ",t.moduleLabel)," ",React.createElement("small",null,React.createElement("i",null,"//",t.moduleDesc)),React.createElement("input",{type:"checkbox",ref:t.moduleName,name:t.id,onChange:e.updateSelectedList.bind(e,t)}),React.createElement("span",null))})),e.state.loading?React.createElement("div",{style:{textAlign:"center"}},React.createElement("h3",null,"Loading...")):null)),React.createElement("div",{className:"form-actions right"},React.createElement("button",{type:"button",className:"btn btn-sm btn-danger",onClick:e.toggleSelect,style:{marginRight:"10px"}},e.state.selectAll?"Uncheck All":"Check All"),React.createElement("button",{type:"button",className:"btn btn-sm btn-success",onClick:e.add},"Add to menu")))}});window.ModuleList=ModuleList,function(e){function t(t){var a="";return a+="<li class='dd-item dd3-item' data-menu_target='"+t.menu_target+"' data-menu_label='"+t.menu_label+"' data-menu_icon='"+t.menu_icon+"' data-menu_link='"+t.menu_link+"' data-menu_type='"+t.menu_type+"'>",a+="<div class='dd-handle dd3-handle'>Drag</div><div class='dd3-content'>"+t.menu_icon+" "+t.menu_label+" <button type='button' data-menu='"+t+"' class='menu-remove-btn btn btn-link btn-xs pull-right'><i class='glyphicon glyphicon-remove font-grey-gallery'></i></button></div>",a+="<ol class='dd-list'>",t.children.map(function(t){t.children&&t.children.length>0?a+=e.nestable.generateDropdownItem(t):a+=e.nestable.generateItem(t)}),a+="</ol>",a+="</li>"}function a(e){var t="";return t+="<li class='dd-item dd3-item' data-menu_target='"+e.menu_target+"' data-menu_label='"+e.menu_label+"' data-menu_icon='"+e.menu_icon+"' data-menu_link='"+e.menu_link+"' data-menu_type='"+e.menu_type+"'>",t+="<div class='dd-handle dd3-handle'>Drag</div><div class='dd3-content'>"+e.menu_icon+" "+e.menu_label+"<button type='button' data-menu='"+e+"' class='menu-remove-btn btn btn-link btn-xs pull-right'><i class='glyphicon glyphicon-remove font-grey-gallery' ></i></button></div>",t+="</li>"}e.nestable={},e.nestable.generateDropdownItem=t,e.nestable.generateItem=a}(window);var MenuBody=React.createClass({displayName:"MenuBody",componentWillReceiveProps:function(e){var t=$(this.refs.root_list),a=this.renderItems(e.data);t.html(a)},renderItems:function(e){for(var t="",a=0;a<e.length;a++)e[a].children&&e[a].children.length>0?t+=window.nestable.generateDropdownItem(e[a]):t+=window.nestable.generateItem(e[a]);return t},render:function(){return React.createElement("div",{className:"panel-body",style:{padding:"20px"}},0==this.props.data.length?React.createElement("h4",null,"Selected group menu is empty."):null,React.createElement("div",{className:"dd",id:this.props.menu_id},React.createElement("ol",{className:"dd-list",ref:"root_list"})))}}),MenuTitle=React.createClass({displayName:"MenuTitle",render:function(){return React.createElement("div",{className:"panel-heading clearfix"},React.createElement("h4",{className:"panel-title pull-left"},React.createElement("strong",null,this.props.title)))}}),FormControl=ReactBootstrap.FormControl,FormGroup=ReactBootstrap.FormGroup,InputGroup=ReactBootstrap.InputGroup,ControlLabel=ReactBootstrap.ControlLabel,Panel=ReactBootstrap.Panel,MenuContainer=React.createClass({displayName:"MenuContainer",getInitialState:function(){return{menuItems:[],groups:[],selectedGroup:"",loading:!1}},componentDidMount:function(){this.getGroups()},componentWillUnmount:function(){this.requestItems.abort(),this.requestGroups.abort()},getGroups:function(){var e=this,t=Routing.generate("ajax_get_menu_group",{},!0);e.requestGroups=$.ajax({url:t,method:"GET"}).done(function(t){e.setState({groups:t})}).fail(function(e){console.log(e)})},getMenuItems:function(){var e=this,t=Routing.generate("ajax_get_menu_by_group",{},!0);e.requestItems=$.ajax({url:t+"?group="+e.state.selectedGroup,method:"GET",beforeSend:function(){e.setState({loading:!0})}}).done(function(t){e.setState({menuItems:t},function(){this.reinitNestable()})}).fail(function(e){console.log(e)}).always(function(){e.setState({loading:!1},function(){this.reinitNestable()})})},setGroup:function(e){if(null==e.target.value||""==e.target.value)return void this.setState({selectedGroup:e.target.value});this.setState({selectedGroup:e.target.value},function(){this.getMenuItems()})},reinitNestable:function(){var e=this,t=$(".dd").nestable().data("nestable"),a=$(".menu-remove-btn"),n=$(".menu-edit-btn");$.each(t.el.find(t.options.itemNodeName),function(e,a){$(a).children(t.options.listNodeName).length&&$(a).children("button").remove()}),t.el.off("click","button"),a.off("click"),n.off("click"),a.on("click",function(t){$(t.target).closest(".dd-item").remove(),e.setState({menuItems:$(".dd").nestable("serialize")}),e.reinitNestable()}),n.on("click",function(e){console.log(e)}),"ontouchstart"in document&&(t.el.off("touchstart"),t.w.off("touchmove"),t.w.off("touchend"),t.w.off("touchcancel")),t.el.off("mousedown"),t.w.off("mousemove"),t.w.off("mouseup"),t.init()},add:function(e){var t=this,a=t.state.menuItems;e.map(function(e){a.push(e)}),t.setState({menuItems:a})},save:function(){var e=this,t={menu:$(".dd").nestable("serialize"),group_id:e.state.selectedGroup},a=Routing.generate("ajax_menu_save",{},!0);console.log(t),$.ajax({url:a,type:"POST",dataType:"json",data:JSON.stringify(t),beforeSend:function(){$.enable_loading("processing")}}).done(function(t){e.notify(t.message,"teal")}).fail(function(t){console.log(t);var a="";switch(t.status){case 403:a=t.responseJSON.message;break;default:a="Menu update failed. Please try again."}e.notify(a,"ruby")}).always(function(){$.disable_loading("processing")})},notify:function(e,t){$.notific8("zindex",11500),$.notific8(e,{heading:"System Message",color:t,life:5e3,verticalEdge:"right",horizontalEdge:"bottom"})},render:function(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-4"},React.createElement("div",{className:"portlet light bordered"},React.createElement("div",{className:"portlet-title"},React.createElement("div",{className:"caption"},React.createElement("span",{className:"caption-subject font-dark bold uppercase"},"System Modules")),React.createElement("div",{className:"tools"},React.createElement("a",{href:"",className:"collapse","data-original-title":"",title:""}," "))),React.createElement("div",{className:"portlet-body form"},React.createElement(ModuleList,{addHandler:this.add,selectedGroup:this.state.selectedGroup}))),React.createElement("div",{className:"portlet light bordered"},React.createElement("div",{className:"portlet-title"},React.createElement("div",{className:"caption"},React.createElement("span",{className:"caption-subject font-dark bold uppercase"},"Custom Menu")),React.createElement("div",{className:"tools"},React.createElement("a",{href:"",className:"collapse","data-original-title":"",title:""}," "))),React.createElement("div",{className:"portlet-body form"},React.createElement(ItemForm,{addHandler:this.add,selectedGroup:this.state.selectedGroup})))),React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(FormGroup,null,React.createElement(ControlLabel,null,"Select Group"),React.createElement(InputGroup,null,React.createElement(FormControl,{componentClass:"select",name:"menu-item",onChange:this.setGroup},React.createElement("option",{value:""},"Select..."),this.state.groups.map(function(e){return React.createElement("option",{key:e.id,value:e.id},e.groupName)})),React.createElement(InputGroup.Button,null,React.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.save,disabled:null==this.state.selectedGroup||""==this.state.selectedGroup},"Save Menu")))))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("div",{className:"panel panel-default"},React.createElement(MenuTitle,{title:"Main Structure"}),this.state.loading?React.createElement("div",{style:{textAlign:"center"}},React.createElement("h3",null,"Loading...")):null,null!=this.state.selectedGroup&&""!=this.state.selectedGroup?React.createElement(MenuBody,{menu_id:"main_menu","data-title":"Main Menu",data:this.state.menuItems}):React.createElement("div",{className:"panel-body",style:{padding:"20px"}},React.createElement("h4",null,"Please select a group")))))))}});window.MenuContainer=MenuContainer;var MenuSection=React.createClass({displayName:"MenuSection",componentDidMount:function(){App.initSlimScroll(".scroller")},render:function(){return React.createElement("div",{className:"portlet light bordered"},React.createElement("div",{className:"portlet-title"},React.createElement("div",{className:"caption"},React.createElement("i",{className:"icon-grid font-grey-gallery"}),React.createElement("span",{className:"caption-subject font-grey-gallery"},"Menu Management"))),React.createElement("div",{className:"portlet-body"},React.createElement(MenuContainer,null)))}});window.MenuSection=MenuSection,ReactDOM.render(React.createElement(MenuSection,null),document.getElementById("content"));