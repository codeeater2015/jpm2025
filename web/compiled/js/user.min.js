var CreateNewUser=function(){"use strict";var e,a=function(){$('input[name="name"]').focus(),e=$("#form_create_user")},t=function(){$("#clear_form").click(function(){s()}),$("#submit_create").click(function(e){e.preventDefault();var a=$(this).closest("form");a.find("div.has-error").removeClass("has-error"),a.find("span.help-block").html(""),$.ajax({url:a.attr("action"),data:a.serialize(),type:"POST",beforeSend:function(){$.show_loading("Processing request...")}}).done(function(e,a,t,o){console.log(e),User.reloadUserGrid(),s(),n("#form_user_alert","info",e.message)}).fail(function(e,t,s){console.log(e),400===e.status?(n("#form_user_alert","danger",e.responseJSON.message),$.each(e.responseJSON.validation_error,function(e,t){a.find('[name="'+e+'"]').closest(".form-group").addClass("has-error"),a.find('[name="'+e+'"]').hasClass("select2-hidden-accessible")?a.find('[name="'+e+'"]').next().next().html(t):a.find('[name="'+e+'"]').closest(".mt-radio-list").hasClass("mt-radio-list")?a.find('[name="'+e+'"]').closest(".mt-radio-list").find(".help-block").html(t):a.find('[name="'+e+'"]').next().html(t)})):$.error_notify(e)}).always(function(e,a,t){$.hide_loading()})}),$('input[name="status"]').bootstrapSwitch("state",!0)},n=function(e,a,t){var n=$('<div style="margin: 0px;" class="alert note note-'+a+' alert-dismissible">                <button type="button" class="close" data-dismiss="alert" aria-label="Close"></button>                <span></span>            </div>');$(e).find(".note").remove(),$(e).append(n),n.addClass("fadeIn animated"),n.find("span").html(t)},s=function(){$('input[name="name"]').focus(),e.find(".has-error").removeClass("has-error"),e.find("span.help-block").html(""),e.find('input:text:not([name="user_id"]), input:password, select, textarea').val(""),e.find('input:radio[value="Male"]').prop("checked",!0),e.find('input[name="status"]').bootstrapSwitch("state",!0)};return{init:function(){a(),t()}}}(),EditUser=function(){var e,a=function(){$('input[name="name"]').focus(),e=$("#form_edit_user")},t=function(){$("#clear_form").on("click",function(){s()}),$("#save_changes").on("click",function(e){e.preventDefault();var a=$(this).closest("form");a.find("div.has-error").removeClass("has-error"),a.find("span.help-block").html(""),$.ajax({url:a.attr("action"),data:a.serialize(),type:"PATCH",beforeSend:function(){$.show_loading("Processing request...")}}).done(function(e,a,t,s){console.log(e),User.reloadUserGrid(),n("#form_user_alert","info",e.message)}).fail(function(e,t,s){console.log(e),400===e.status?(n("#form_user_alert","danger",e.responseJSON.message),$.each(e.responseJSON.validation_error,function(e,t){a.find('[name="'+e+'"]').closest(".form-group").addClass("has-error"),a.find('[name="'+e+'"]').hasClass("select2-hidden-accessible")?a.find('[name="'+e+'"]').next().next().html(t):a.find('[name="'+e+'"]').closest(".mt-radio-list").hasClass("mt-radio-list")?a.find('[name="'+e+'"]').closest(".mt-radio-list").find(".help-block").html(t):a.find('[name="'+e+'"]').next().html(t)})):$.error_notify(e)}).always(function(e,a,t){$.hide_loading()})}),$('input[name="status"]').bootstrapSwitch()},n=function(e,a,t){var n=$('<div style="margin: 0px;" class="alert note note-'+a+' alert-dismissible">                <button type="button" class="close" data-dismiss="alert" aria-label="Close"></button>                <span></span>            </div>');$(e).find(".note").remove(),$(e).append(n),n.addClass("fadeIn animated"),n.find("span").html(t)},s=function(){$('input[name="name"]').focus(),e.find(".has-error").removeClass("has-error"),e.find("span.help-block").html(""),e.find('input:text:not([name="user_id"]), input:password, select, textarea').val(""),e.find('input:radio[value="Male"]').prop("checked",!0),e.find('input[name="status"]').bootstrapSwitch("state",!0)};return{init:function(){a(),t()}}}(),ChangeUserPassword=function(){"use strict";var e,a=function(){e=$("#form_change_user_password"),$('input[name="password"]').focus()},t=function(){$("#save_changes").click(function(e){e.preventDefault();var a=$(this).closest("form");a.find("div.has-error").removeClass("has-error"),a.find("span.help-block").html(""),$.ajax({url:a.attr("action"),data:a.serialize(),type:"POST",beforeSend:function(){$.show_loading("Processing request...")}}).done(function(e,a,t,s){console.log(e),n("#form_user_alert","info",e.message)}).fail(function(e,t,s){console.log(e),400===e.status?(n("#form_user_alert","danger",e.responseJSON.message),$.each(e.responseJSON.validation_error,function(e,t){a.find('[name="'+e+'"]').closest(".form-group").addClass("has-error"),a.find('[name="'+e+'"]').next().html(t)})):$.error_notify(e)}).always(function(){$.hide_loading()})})},n=function(e,a,t){var n=$('<div class="alert note note-'+a+' alert-dismissible">                <button type="button" class="close" data-dismiss="alert" aria-label="Close"></button>                <span></span>            </div>');$(e).find(".note").remove(),$(e).append(n),n.addClass("fadeIn animated"),n.find("span").html(t)};return{init:function(){a(),t()}}}(),User=function(){var e=$("#user_table"),a=new Datatable,t=$("#create"),n=$("#batch_delete"),s=$("#modal_view_user"),o=$("#modal_create_new_user"),i=$("#modal_edit_user"),r=$("#modal_change_user_password"),l=function(){c()},d=function(){t.on("click",function(){f()}),n.on("click",function(){g()}),e.find("tbody").on("click",".user-view-btn",function(e){e.preventDefault(),$(this).blur();var t=a.getDataTable().row($(this).parents("tr")).data();m(t)}),e.find("tbody").on("click",".user-edit-btn",function(e){e.preventDefault(),$(this).blur();var t=a.getDataTable().row($(this).parents("tr")).data();h(t)}),e.find("tbody").on("click",".user-change-password-btn",function(e){e.preventDefault(),$(this).blur();var t=a.getDataTable().row($(this).parents("tr")).data();p(t)}),e.find("tbody").on("click",".user-delete-btn",function(e){e.preventDefault(),$(this).blur();var t=a.getDataTable().row($(this).parents("tr")).data();b(t)}),s.on("show.bs.modal",function(e){"bs.modal"===e.namespace&&$.show_loading("Please wait...")}).on("hidden.bs.modal",function(){$(this).removeData("bs.modal").find(".modal-content").empty()}),o.on("show.bs.modal",function(e){"bs.modal"===e.namespace&&$.show_loading("Please wait...")}).on("hidden.bs.modal",function(){$(this).removeData("bs.modal").find(".modal-content").empty()}),i.on("show.bs.modal",function(e){"bs.modal"===e.namespace&&$.show_loading("Please wait...")}).on("hidden.bs.modal",function(){$(this).removeData("bs.modal").find(".modal-content").empty()}),r.on("show.bs.modal",function(e){"bs.modal"===e.namespace&&$.show_loading("Please wait...")}).on("hidden.bs.modal",function(){$(this).removeData("bs.modal").find(".modal-content").empty()})},c=function(){var t=Routing.generate("ajax_get_datatable_users_list",{},!0);a.init({src:e,loadingMessage:"Loading...",dataTable:{bState:!0,autoWidth:!0,deferRender:!0,ajax:{url:t,type:"GET"},columnDefs:[{orderable:!1,targets:[0,6]},{className:"align-center",targets:[0,3,4,5,6]}],order:[[0,"desc"]],columns:[{data:"id",render:function(e,a,t){return"YES"===t.isDefault?"":'<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"><input name="id[]" type="checkbox" class="checkboxes" value="'+e+'"/><span></span></label>'}},{data:"name"},{data:"username",render:function(e){return'<a href="'+Routing.generate("homepage",{},!0)+"?_switch_user="+e+'">'+e+"</a>"}},{data:"gender"},{data:"groupName"},{data:"isActive"},{render:function(e,a,t){return"YES"===t.isDefault?"<span class='badge badge-info'>Default</span>":"<a href='#' class='btn btn-xs btn-success user-view-btn' data-toggle='tooltip' data-title='View'><i class='glyphicon glyphicon-eye-open' ></i></a><a href='#' class='btn btn-xs btn-primary user-edit-btn' data-toggle='tooltip' data-title='Edit'><i class='glyphicon glyphicon-edit'></i></a><a href='#' class='btn btn-xs font-white bg-green-dark user-change-password-btn' data-toggle='tooltip' data-title='Change Password'><i class='fa fa-lock' ></i></a><a href='#' class='btn btn-xs btn-danger user-delete-btn' data-toggle='tooltip' data-title='Delete'><i class='glyphicon glyphicon-trash'></i></a>"}}]}})},u=function(){a.getDataTable().ajax.reload()},m=function(e){s.modal("show");var a=Routing.generate("modal_view_user",{},!0);s.load(a+"?id="+e.id,function(e,a,t){$.hide_loading(),"error"===a&&$(this).html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-red-mint"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h3 style="color:#000;" class="modal-title bg-font-red-mint"> Error Response</h3></div><div class="modal-body"><span> Sorry but there was an error : '+t.status+" "+t.statusText+"</span></div></div></div>")})},f=function(){o.modal("show");var e=Routing.generate("modal_create_new_user",{},!0);o.load(e,function(e,a,t){$.hide_loading(),"error"===a?$(this).html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-red-mint"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h3 style="color:#000;" class="modal-title bg-font-red-mint"> Error Response</h3></div><div class="modal-body"><span> Sorry but there was an error : '+t.status+" "+t.statusText+"</span></div></div></div>"):CreateNewUser.init()})},h=function(e){i.modal("show");var a=Routing.generate("modal_edit_user",{},!0);i.load(a+"?id="+e.id,function(e,a,t){$.hide_loading(),"error"===a?$(this).html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-red-mint"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h3 style="color:#000;" class="modal-title bg-font-red-mint"> Error Response</h3></div><div class="modal-body"><span> Sorry but there was an error : '+t.status+" "+t.statusText+"</span></div></div></div>"):EditUser.init()})},p=function(e){r.modal("show");var a=Routing.generate("modal_change_user_password",{},!0);r.load(a+"?id="+e.id,function(e,a,t){$.hide_loading(),"error"===a?$(this).html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-red-mint"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h3 style="color:#000;" class="modal-title bg-font-red-mint"> Error Response</h3></div><div class="modal-body"><span> Sorry but there was an error : '+t.status+" "+t.statusText+"</span></div></div></div>"):ChangeUserPassword.init()})},b=function(e){bootbox.dialog({title:"System Message",message:"Are you sure you want to remove this user?",buttons:{confirm:{label:"Yes, Delete",className:"btn-danger",callback:function(){var a=Routing.generate("ajax_delete_user",{id:e.id},!0);$.ajax({url:a,type:"DELETE",beforeSend:function(){$.show_loading("Processing request...")}}).done(function(e){u(),$.notify(e.message,"teal")}).fail(function(e){$.error_notify(e)}).always(function(){$.hide_loading()})}},cancel:{label:"Cancel",className:"btn-default "}}})},g=function(){var e=a.getSelectedRowsCount(),t=a.getSelectedRows();if(0===e)return bootbox.alert("Please select a user(s) you want to remove!"),!1;var n=e>1?e+" users":e+" user";bootbox.dialog({title:"System Message",message:"You have selected "+n+". Are you sure you want to remove?",buttons:{confirm:{label:"Yes, Delete",className:"btn-danger",callback:function(){var e=Routing.generate("ajax_batch_delete_user",{},!0);$.ajax({url:e,type:"DELETE",data:{id:t},beforeSend:function(){$.show_loading("Processing request...")}}).done(function(e){u(),$.notify(e.message,"teal")}).fail(function(e){$.error_notify(e)}).always(function(){$.hide_loading()})}},cancel:{label:"Cancel",className:"btn-default "}}})};return{init:function(){l(),d()},reloadUserGrid:function(){u()}}}();jQuery(document).ready(function(){User.init()});