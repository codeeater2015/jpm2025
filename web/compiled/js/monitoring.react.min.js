var DataImportDatatable=React.createClass({displayName:"DataImportDatatable",getInitialState:function(){return{showViewModal:!1,target:null,typingTimer:null,doneTypingInterval:1500}},componentDidMount:function(){this.initDatatable()},initDatatable:function(){var e=this,t=new Datatable,a=$("#voter_table");t.init({src:a,dataTable:{bState:!0,autoWidth:!0,serverSide:!0,processing:!0,ajax:{url:Routing.generate("ajax_datatable_to_send_voter"),type:"GET",data:function(t){t.provinceCode=53,t.municipalityNo=$("#voter_table #municipality_select2").val(),t.brgyNo=$("#voter_table #barangay_select2").val(),t.precinctNo=$("#voter_table #precinct_select2").val(),t.voterName=$('#voter_table input[name="voter_name"]').val(),t.birthdate=$('#voter_table input[name="birthdate"]').val(),t.cellphone=$('#voter_table input[name="cellphone"]').val(),t.voterGroup=$('#voter_table input[name="voter_group"]').val(),t.brgyCluster=$('#voter_table input[name="brgy_cluster"]').val(),t.electId=e.props.electId,t.proId=e.props.proId}},columnDefs:[{className:"text-center valign-middle",orderable:!1,targets:[0,4,5,6,7]}],order:[[1,"asc"]],columns:[{data:null,className:"text-center",width:30,render:function(e,t,a,n){return n.settings._iDisplayStart+n.row+1}},{data:"voter_name",render:function(e,t,a){return(1==a.voted_2017?"*":"")+e}},{data:"municipality_name",width:150,className:"text-center"},{data:"barangay_name",className:"text-center",width:100},{data:"cellphone_no",className:"text-center",width:100},{data:"voter_group",className:"text-center",width:50},{data:"has_id",className:"text-center",width:50,render:function(e){return 1==e?"YES":"NO"}},{width:20,render:function(e,t,a){return""},className:"text-center"}]}}),a.on("click",".edit2-btn",function(){var a=t.getDataTable().row($(this).parents("tr")).data();e.edit2(a.pro_voter_id)}),a.on("click",".edit-btn",function(){var a=t.getDataTable().row($(this).parents("tr")).data();e.edit(a.pro_voter_id)}),a.on("click",".assign-btn",function(){var a=t.getDataTable().row($(this).parents("tr")).data();e.assign(a.pro_id_code)}),a.on("click",".delete-btn",function(){var a=t.getDataTable().row($(this).parents("tr")).data();e.delete(a.pro_voter_id)}),a.on("keypress",".form-filter",function(t){13==t.charCode&&e.reload()}),e.grid=t},isEmpty:function(e){return null==e||""==e||"undefined"==e||e<=0},openViewModal:function(e){console.log("open view modal"),this.setState({showViewModal:!0,target:e})},closeViewModal:function(){this.setState({showViewModal:!1,target:null})},handleFilterChange:function(){var e=this;clearTimeout(this.state.typingTimer),this.state.typingTimer=setTimeout(function(){e.reload()},this.state.doneTypingInterval)},reload:function(){this.grid.getDataTable().ajax.reload()},render:function(){return React.createElement("div",null,this.state.showViewModal&&React.createElement(DataImportViewModal,{show:this.state.showViewModal,onHide:this.closeViewModal,hdrId:this.state.target}),React.createElement("div",{className:"table-container"},React.createElement("div",{className:"table-actions-wrapper"}),React.createElement("table",{id:"voter_table",className:"table table-striped table-bordered",width:"100%"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"text-center"},"No"),React.createElement("th",null,"Name"),React.createElement("th",{className:"text-center"},"Municipality"),React.createElement("th",{className:"text-center"},"Brgy"),React.createElement("th",{className:"text-center"},"CP #"),React.createElement("th",{className:"text-center"},"Position"),React.createElement("th",{className:"text-center"},"Has Id"),React.createElement("th",null)),React.createElement("tr",null,React.createElement("td",null),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("input",{type:"text",className:"form-control form-filter input-sm",name:"voter_name"})),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("select",{id:"municipality_select2",className:"form-control form-filter input-sm"})),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("select",{id:"barangay_select2",className:"form-control form-filter input-sm"})),React.createElement("td",{style:{padding:"10px 5px"}}),React.createElement("td",{style:{padding:"10px 5px"}},React.createElement("input",{type:"text",className:"form-control form-filter input-sm",name:"voter_group"})),React.createElement("td",{className:"text-center"}),React.createElement("td",null))),React.createElement("tbody",null))))}});window.DataImportDatatable=DataImportDatatable;var Modal=ReactBootstrap.Modal,FormGroup=ReactBootstrap.FormGroup,HelpBlock=ReactBootstrap.HelpBlock,ControlLabel=ReactBootstrap.ControlLabel,FormControl=ReactBootstrap.FormControl,DataUpdaterModal=React.createClass({displayName:"DataUpdaterModal",getInitialState:function(){return{unselected:[],options:[],form:{data:{projectVoters:[]},errors:[]},isLoading:!1,progressValue:0}},componentDidMount:function(){this.initComponents(),this.loadProjectVoters()},loadProjectVoters:function(){var e=this;e.requestProjectVoters=$.ajax({url:Routing.generate("ajax_get_to_send_voter",{proId:this.props.proId,electId:this.props.electId}),type:"GET"}).done(function(t){e.setState({options:t,unselected:t}),setTimeout(e.refreshSelectBox,2e3)})},componentWillUnmount:function(){this.isEmpty(this.requestProjectVoters)||this.requestProjectVoters.abort()},initComponents:function(){this.initMultiSelect()},initMultiSelect:function(){var e=this,t=this.refs.selectBox;$(t).multiSelect({selectableOptgroup:!0,selectableHeader:"<input placeholder='Enter Name' type='text' class='form-control' autocomplete='off' style='text-transform:uppercase;margin-bottom:5px;'>",selectionHeader:"<input placeholder='Enter Name' type='text' class='form-control' autocomplete='off' style='text-transform:uppercase;margin-bottom:5px;'>",afterInit:function(e){var t=this,a=t.$selectableUl.prev(),n=t.$selectionUl.prev(),r="#"+t.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",o="#"+t.$container.attr("id")+" .ms-elem-selection.ms-selected";t.qs1=a.quicksearch(r).on("keydown",function(e){if(40===e.which)return t.$selectableUl.focus(),!1}),t.qs2=n.quicksearch(o).on("keydown",function(e){if(40==e.which)return t.$selectionUl.focus(),!1})},afterSelect:function(t){this.qs1.cache(),this.qs2.cache(),e.setProjectVoters($(e.refs.selectBox).val())},afterDeselect:function(t){this.qs1.cache(),this.qs2.cache(),e.setProjectVoters($(e.refs.selectBox).val())},cssClass:"fluid-size"})},refreshSelectBox:function(){$(this.refs.selectBox).multiSelect("refresh")},deselectAll:function(){$(this.refs.selectBox).multiSelect("deselect_all")},selectAll:function(){$(this.refs.selectBox).multiSelect("select_all")},setProjectVoters:function(e){var t=this.state.form,a=[];null!=e?(t.data.projectVoters=e,a=this.state.options.filter(function(t){return-1==e.indexOf(t.pro_voter_id)})):(t.data.projectVoters=[],a=this.state.options),this.setState({form:t,unselected:a})},setFormProp:function(e){var t=this.state.form;t.data[e.target.name]=e.target.value,this.setState({form:t})},setErrors:function(e){var t=this.state.form;t.errors=e,this.setState({form:t})},getError:function(e){var t=this.state.form.errors;for(var a in t)if(a==e)return t[e];return null},getValidationState:function(e){return null!=this.getError(e)?"error":null},submit:function(e){e.preventDefault();var t=this,a=t.state.form.data,n=!1;t.requestPostUpdate=$.ajax({url:Routing.generate("ajax_post_to_send_records"),type:"POST",data:a,xhrFields:{onprogress:function(e){var a,r=e.currentTarget.response;!1===n?(a=r,n=r.length):(a=r.substring(n),n=r.length),t.setState({progressValue:parseInt(a)})}}}).done(function(){t.props.notify("Data has been sent","ruby"),t.props.onHide(),t.props.onSuccess()}).fail(function(e){t.props.notify("Opps!","ruby"),t.setErrors(e.responseJSON)}).always(function(){t.setState({isLoading:!1,progressValue:0})}),t.setState({isLoading:!0,progressValue:0})},popupCenter:function(e,t,a,n){var r=void 0!=window.screenLeft?window.screenLeft:screen.left,o=void 0!=window.screenTop?window.screenTop:screen.top,l=0,c=0;l=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,c=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var s=l/2-a/2+r,i=c/2-n/2+o,d=window.open(e,t,"scrollbars=yes, width="+a+", height="+n+", top="+i+", left="+s);window.focus&&d.focus()},isEmpty:function(e){return null==e||""==e},render:function(){return React.createElement(Modal,{enforceFocus:!1,backdrop:"static",dialogClassName:"modal-custom-85",show:this.props.show,onHide:this.props.onHide},React.createElement(Modal.Header,{closeButton:!0},React.createElement(Modal.Title,null,"Data Updater Modal")),React.createElement(Modal.Body,{bsClass:"modal-body overflow-auto"},React.createElement("form",{onSubmit:this.submit},React.createElement("div",{className:"text-right"},React.createElement("button",{type:"button",onClick:this.deselectAll,className:"btn btn-xs btn-default",style:{marginRight:"5px"}},"Deselect All"),React.createElement("button",{type:"button",onClick:this.selectAll,className:"btn btn-xs btn-success"},"Select All")),React.createElement("div",{className:"clearfix"}),React.createElement("div",{className:"col-md-6 remove-padding"},React.createElement("div",{style:{marginLeft:"-15px"}},React.createElement("strong",null,"Available :")," ",this.state.unselected.length)),React.createElement("div",{className:"col-md-6 "},React.createElement("div",{style:{marginLeft:"30px"}},React.createElement("strong",null,"Selected : ")," ",this.state.form.data.projectVoters.length)),React.createElement(FormGroup,{controlId:"formProjectVoters",validationState:this.getValidationState("projectVoters")},React.createElement("select",{multiple:!0,ref:"selectBox",className:"searchable",id:"voters_multiselect",name:"projectVoters[]"},this.state.options.map(function(e){return React.createElement("option",{key:e.pro_voter_id,value:e.pro_voter_id},e.voter_name," / ",e.barangay_name," (",moment().format("MMM DD, YYYY hh:mm A"),")")})),React.createElement("div",{className:"text-right"},React.createElement(HelpBlock,null,this.getError("projectVoters")))),React.createElement("div",{className:"clearfix"}),this.state.isLoading&&React.createElement("div",{className:"progress"},React.createElement("div",{className:"progress-bar",role:"progressbar","aria-valuenow":this.state.progressValue,"aria-valuemin":"0","aria-valuemax":"100",style:{width:this.state.progressValue+"%"}},React.createElement("span",null," ",this.state.progressValue," % Complete"))),React.createElement("div",{className:"text-right m-t-md"},React.createElement("button",{type:"button",className:"btn btn-default",style:{marginRight:"10px"},onClick:this.props.onHide},"Cancel"),React.createElement("button",{type:"submit",className:"btn btn-primary"},"Submit")))))}});window.DataUpdaterModal=DataUpdaterModal;var UpdateManager=React.createClass({displayName:"UpdateManager",getInitialState:function(){return{showUpdaterModal:!1,user:null,filters:{proId:null,electId:null,provinceCode:null}}},notify:function(e,t){$.notific8("zindex",11500),$.notific8(e,{heading:"System Message",color:t,life:5e3,verticalEdge:"right",horizontalEdge:"top"})},componentDidMount:function(){this.initSelect2(),this.loadUser(window.userId)},loadUser:function(e){var t=this;t.requestUser=$.ajax({url:Routing.generate("ajax_get_user",{id:e}),type:"GET"}).done(function(e){t.setState({user:e},t.reinitSelect2)})},initSelect2:function(){var e=this;$("#update_manager_component #election_select2").select2({casesentitive:!1,placeholder:"Select Election...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_elections"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.elect_id,text:e.elect_name}})}}}}),$("#update_manager_component #project_select2").select2({casesentitive:!1,placeholder:"Select Project...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_projects"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.pro_id,text:e.pro_name}})}}}}),$("#update_manager_component #province_select2").select2({casesentitive:!1,placeholder:"Enter Province...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_province"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.province_code,text:e.name}})}}}}),$("#update_manager_component #election_select2").on("change",function(){var t=e.state.filters;t.electId=$(this).val(),e.setState({filters:t})}),$("#update_manager_component #project_select2").on("change",function(){var t=e.state.filters;t.proId=$(this).val(),e.setState({filters:t})}),$("#voter_table #province_select2").on("change",function(){var t=e.state.filters;t.provinceCode=$(this).val(),e.setState({filters:t})})},reinitSelect2:function(){var e=this;if(!e.isEmpty(e.state.user.project)){var t=e.state.user.project.provinceCode;e.requestProvince=$.ajax({url:Routing.generate("ajax_get_province",{provinceCode:t}),type:"GET"}).done(function(e){$("#update_manager_component #province_select2").empty().append($("<option/>").val(e.province_code).text(e.name)).trigger("change")}),e.requestProject=$.ajax({url:Routing.generate("ajax_get_project",{proId:e.state.user.project.proId}),type:"GET"}).done(function(e){$("#update_manager_component #project_select2").empty().append($("<option/>").val(e.proId).text(e.proName)).trigger("change")})}e.requestActiveElection=$.ajax({url:Routing.generate("ajax_get_active_election"),type:"GET"}).done(function(e){$("#update_manager_component #election_select2").empty().append($("<option/>").val(e.electId).text(e.electName)).trigger("change")}),e.state.user.isAdmin||($("#update_manager_component #election_select2").attr("disabled","disabled"),$("#update_manager_component #province_select2").attr("disabled","disabled"),$("#update_manager_component #project_select2").attr("disabled","disabled"))},openUpdaterModal:function(){console.log("opening updater!"),this.setState({showUpdaterModal:!0})},closeUpdaterModal:function(){this.setState({showUpdaterModal:!1})},isEmpty:function(e){return null==e||""==e||"undefined"==e||e<=0},reloadDatatable:function(){this.refs.importHeaderDatatable.reload()},render:function(){return React.createElement("div",{className:"portlet light portlet-fit bordered",id:"update_manager_component"},React.createElement("div",{className:"portlet-body"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-5"},React.createElement("div",null,React.createElement("h3",null,"For Sending")),React.createElement("button",{type:"button",onClick:this.openUpdaterModal,className:"btn btn-sm green"},"Send Updates"),this.state.showUpdaterModal&&React.createElement(DataUpdaterModal,{notify:this.notify,show:this.state.showUpdaterModal,onHide:this.closeUpdaterModal,proId:this.state.filters.proId,electId:this.state.filters.electId,provinceCode:this.state.filters.provinceCode,onSuccess:this.reloadDatatable})),React.createElement("div",{className:"col-md-7"},React.createElement("form",{onSubmit:this.onApplyCode},React.createElement("div",{className:"col-md-3 col-md-offset-1"},React.createElement("select",{id:"election_select2",className:"form-control form-filter input-sm"})),React.createElement("div",{className:"col-md-4"},React.createElement("select",{id:"province_select2",className:"form-control form-filter input-sm"})),React.createElement("div",{className:"col-md-4"},React.createElement("select",{id:"project_select2",className:"form-control form-filter input-sm"}))))),React.createElement("br",null),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement(DataImportDatatable,{proId:this.state.filters.proId,electId:this.state.filters.electId,ref:"importHeaderDatatable"})))))}});setTimeout(function(){ReactDOM.render(React.createElement(UpdateManager,null),document.getElementById("component-container"))},500);